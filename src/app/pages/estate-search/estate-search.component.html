<div *ngIf="screenLoading" class="loader">
  <mat-spinner [diameter]="200"></mat-spinner>
</div>

<ng-container *ngIf="!screenLoading">
  <div class="background">
    <div class="search-container">
      <h1 class="search-header">Узнайте предполагаемый срок окупаемости</h1>
      <div class="search-section">
        <div class="range-control range upper-range">
          <div class="range-label">Срок окупаемости, годы</div>
          <ng5-slider [(value)]="coeffSelectedMin" [(highValue)]="coeffSelectedMax" [options]="{floor: coeffMin, ceil: coeffMax}"></ng5-slider>
        </div>
        <div class="range-control range">
          <div class="range-label">Площадь, м&#178;</div>
          <ng5-slider [(value)]="squareSelectedMin" [(highValue)]="squareSelectedMax" [options]="{floor: squareMin, ceil: squareMax}"></ng5-slider>
        </div>
        <div class="range-control range">
          <div class="range-label">Цена, &#8381;</div>
          <ng5-slider [(value)]="priceSelectedMin" [(highValue)]="priceSelectedMax" [options]="{floor: priceMin, ceil: priceMax}"></ng5-slider>
        </div>
      </div>
      <div class="search-button-section">
        <button class="background-warning util"
                [class.disable-search]="estatesLoading"
                mat-raised-button
                [disabled]="estatesLoading"
                (click)="onSearchEstatesClicked()">
          {{ estatesLoading ? '' : 'Найти'}}
          <mat-spinner *ngIf="estatesLoading" class="spinner" [diameter]="20"></mat-spinner>
        </button>
      </div>
    </div>
  </div>
  <div class="stats-container">
    <div class="stats-item">
      <div class="stats-number">{{averagePayback}}</div>
      <div class="stats-sub-header">Средний срок окупаемости, годы</div>
    </div>
    <div class="stats-item">
      <div class="stats-number">{{recordsCount}}</div>
      <div class="stats-sub-header">Всего просмотрено объявлений</div>
    </div>
    <div class="stats-item">
      <div class="stats-number">{{flatsCount}}</div>
      <div class="stats-sub-header">Найдено объектов с окупаемостью</div>
    </div>
  </div>
  <div class="result-container">
    <div class="map-container">
      <mat-spinner *ngIf="estatesLoading" class="spinner" [diameter]="150"></mat-spinner>
      <angular-yandex-map *ngIf="!estatesLoading" [center]="[(estates[0] || {latitude: 55.75}).latitude, (estates[0] || {longitude: 37.61}).longitude]" [options]="{searchControlProvider: 'yandex#search'}" [zoom]="9">
        <ng-container *ngFor="let estate of estates">
          <angular-yandex-placemark
                                    [geometry]="[estate.latitude, estate.longitude]"
                                    [properties]="{price: estate.sell_price, coeff: estate.coeff}"
                                    [options]="{balloonContentLayout: MyBalloonContentLayoutClass}"
                                    (yaclick)="onEstateClicked($event, estate)"
          ></angular-yandex-placemark>
        </ng-container>
      </angular-yandex-map>
    </div>
    <div *ngIf="selectedEstate" class="results">
      <div>Цена продажи: {{selectedEstate.sell_price}} &#8381;</div>
      <div>Цена аренды: {{selectedEstate.rent_price}} &#8381;/month</div>
      <div>Срок окупаемости: {{selectedEstate.coeff}} лет</div>
      <button class="background-warning more-button"
              mat-raised-button
              (click)="onEstatePlacemarkClickedNew(selectedEstate.sell_url, selectedEstate.rent_url)">
        Подробнее
      </button>
    </div>
  </div>
  <app-footer (contact)="navigate('landing')"></app-footer>
</ng-container>
